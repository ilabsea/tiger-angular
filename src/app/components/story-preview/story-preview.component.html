<mat-toolbar color="primary">
  <app-menu-button></app-menu-button>
  <span>Preview Story: {{story.title}}</span>
  <span class='spacer'></span>
  <a mat-button (click)='location.back()'>Done</a>
</mat-toolbar>

<section class="mat-typography flex-center" *ngIf='(!dataSource.length && !questions.length) || loading'>
  <div *ngIf="!dataSource.length && !loading" class='no-item-available'>
    <h3 class='mat-title'>No Scene Available.</h3>
  </div>

  <mat-spinner diameter='40' *ngIf='loading' color='accent'></mat-spinner>
</section>

<div class="content-wrapper demo-phone mat-typography" [hidden]="(!dataSource.length && !questions.length) || loading">

  <carousel #carousel="carousel" [showControls]="false" class='slide-wrapper'>

    <ng-container *ngFor="let scene of dataSource">
      <ng-container *carouselItem>
        <div class='flow-row flex1' style='position: relative;'>
          <div class="item flex-column flex1">

            <div class='flex-column mat-subheading-2 name'>
              <div class="flex1" *ngIf='scene.visible_name'>
                {{scene.name}}
              </div>
              <div class="flex-end">
                <audio controls *ngIf='!!scene.audio'>
                  <source [src]="endpointUrl + scene.audio" type="audio/mpeg">
                    Your browser does not support this audio format.
                </audio>
              </div>
            </div>

            <div class="thumbnail bg" *ngIf='(!!scene.image && scene.image_as_background) || !scene.image'>
              <img [src]="endpointUrl + scene.image" *ngIf='!!scene.image && scene.image_as_background' />
            </div>

            <div class="thumbnail">
              <div *ngIf='!!scene.image && !scene.image_as_background'>
                <img [src]="endpointUrl + scene.image" />
              </div>
            </div>

            <div class='description'>{{scene.description}}</div>

            <div class='actions flex-column' *ngIf='!scene.is_end' style='max-width: 100%;'>
              <a *ngFor="let action of scene.scene_actions"  mat-raised-button (click)="hanleActionClick(action, carousel)">
                <span *ngIf="(action.link_scene | json) == '{}' && questions.length">Go to quiz</span>
                <span *ngIf="(action.link_scene | json) != '{}'">{{action.name}}</span>
              </a>
            </div>

            <div class='actions flex-column' *ngIf='scene.is_end && questions.length'>
              <a mat-raised-button (click)="slideTo(carousel, null)"> Go to quiz </a>
            </div>

          </div>
        </div>
      </ng-container>
    </ng-container>

    <ng-container *ngFor="let question of questions; let i = index">
      <ng-container *carouselItem>
        <div class='flow-row flex1'>
          <div class="item flex-column flex1">
            <div class='mat-title name'>Quiz: question {{i + 1}}/{{questions.length}}</div>
            <div class='flex1 flex-center description'>{{question.label}}</div>

            <div class='actions flex-column'>
              <a *ngFor="let choice of question.choices" mat-raised-button class="btn btn-success" (click)='slideQuizTo(carousel, i+1, choice)' style='white-space: normal;'>{{choice.label}}</a>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>

  </carousel>

</div>
